{% extends "campaigns/base.html" %}
{% block title %}Campaign {{ campaign.name }}{% endblock %}

{% block content %}
<div class="card neon-card">
  <div class="card-content">
    <span class="card-title">{{ campaign.name }}</span>
    <p><strong>Subject:</strong> {{ campaign.subject }}</p>
    <p><strong>Status:</strong> {{ campaign.status }}</p>
    <p><strong>Scheduled:</strong> {{ campaign.scheduled_time|date:"Y-m-d H:i" }}</p>

    <div style="margin-top:12px;">
      <span>Total: {{ total }}</span> •
      <span>Sent: {{ sent }}</span> •
      <span class="red-text">Failed: {{ failed }}</span> •
      <span>Pending: {{ pending }}</span>
    </div>

    <div style="margin-top:16px;">
      <a href="{% url 'campaigns:campaign_trigger_now' campaign.id %}"
         class="btn btn-neon waves-effect">
        <i class="material-icons left">send</i>
        Trigger Send Now
      </a>
    </div>
  </div>
</div>

<div class="card neon-card">
  <div class="card-content">
    <span class="card-title">Recipients & Delivery Status</span>
    <table class="highlight responsive-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Status</th>
          <th>Failure Reason</th>
        </tr>
      </thead>
      <tbody>
        {% for cr in recipients %}
        <tr>
          <td>{{ cr.recipient.name }}</td>
          <td>{{ cr.recipient_email_snapshot }}</td>
          <td>{{ cr.status|title }}</td>
          <td class="red-text text-darken-1">
            {{ cr.failure_reason|default:"—" }}
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="4">No recipients attached to this campaign yet.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
